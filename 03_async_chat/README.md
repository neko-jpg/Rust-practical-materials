# Level 3: 非同期チャットシステム

## 課題
`tokio` を使用して、複数のクライアントがリアルタイムにメッセージをやり取りできるチャットサーバーとクライアントを作成します。

## 学習目標
- **非同期プログラミング**: `async/await` の挙動理解。
- **Tokioランタイム**: `tokio::spawn`, `tokio::select!` の活用。
- **チャネル通信**: `tokio::sync::broadcast` を使った 1対多 の通信。

## 実行方法
1. サーバー起動:
   ```bash
   cargo run --bin server
   ```
2. クライアント起動（別のターミナルで複数立ち上げる）:
   ```bash
   cargo run --bin client
   ```

## 実装ステップ

### Server (`src/bin/server.rs`)
1. TCPリスナーをバインドし、ループで接続を受け入れる。
2. 接続ごとに `tokio::spawn` で軽量スレッド（タスク）を生成。
3. `broadcast` チャネルを使って、受信したメッセージを全クライアントに配信する。

### Client (`src/bin/client.rs`)
1. サーバーに接続する。
2. 以下の2つの処理を同時に (`tokio::select!`) 行う：
    - 標準入力から文字を読み取り、ソケットに送信。
    - ソケットからメッセージを受信し、標準出力に表示。

## Advanced Challenges (発展課題)

### 1. Graceful Shutdown
- `Ctrl+C` シグナル (`tokio::signal::ctrl_c`) を検知し、サーバーを安全に停止させてください。
- 全てのクライアント接続を切断し、リソースを解放してからプロセスを終了します。

### 2. Backpressure (背圧制御)
- チャネルの容量 (`10`) を超える速度でメッセージが来た場合の挙動を確認してください。
- `broadcast::error::RecvError::Lagged` をハンドリングし、「メッセージを取りこぼしました」とクライアントに通知してください。

### 3. アーキテクチャ改善
- 現在の `main` 関数内のロジックを、`ChatServer` 構造体などにカプセル化し、テスト可能な形にリファクタリングしてください。
